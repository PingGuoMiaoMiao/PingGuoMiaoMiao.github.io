# 项目依赖库列表

## 项目信息

- **项目名称**：nextblog
- **项目类型**：Astro 静态站点生成项目
- **Node.js 版本要求**：18.0.0 及以上
- **包管理器**：npm

---

## 核心依赖（dependencies）

核心依赖是项目运行所必需的库，会被打包到生产环境中。

### 1. Astro 框架及相关集成

#### astro
- **版本**：^4.10.1
- **许可证**：MIT
- **用途**：核心静态站点生成框架，提供构建、开发服务器、组件系统等功能
- **官方文档**：https://docs.astro.build
- **说明**：本项目的主要框架，负责静态站点生成、组件编译、路由生成等核心功能

#### @astrojs/preact
- **版本**：^3.4.0
- **许可证**：MIT
- **用途**：Astro 的 Preact 集成，允许在 Astro 项目中使用 Preact 组件
- **官方文档**：https://docs.astro.build/en/guides/integrations-guide/preact/
- **说明**：用于实现交互式组件，如搜索功能、评论系统等需要客户端交互的组件

#### @astrojs/rss
- **版本**：^4.0.5
- **许可证**：MIT
- **用途**：RSS Feed 生成器，自动生成 RSS 订阅源
- **官方文档**：https://docs.astro.build/en/guides/rss/
- **说明**：用于生成博客的 RSS 订阅源，方便用户使用 RSS 阅读器订阅博客内容

#### @astrojs/sitemap
- **版本**：^3.2.0
- **许可证**：MIT
- **用途**：自动生成 XML Sitemap，提升搜索引擎索引效率
- **官方文档**：https://docs.astro.build/en/guides/integrations-guide/sitemap/
- **说明**：在构建时自动生成 sitemap.xml，包含所有已发布文章的 URL，有助于 SEO 优化

#### @astrojs/check
- **版本**：^0.5.10
- **许可证**：MIT
- **用途**：TypeScript 类型检查工具，用于验证 Astro 项目的类型安全
- **官方文档**：https://docs.astro.build/en/reference/cli-reference/#astro-check
- **说明**：在构建前进行类型检查，确保代码的类型安全性

### 2. 内容处理

#### marked
- **版本**：^17.0.0
- **许可证**：MIT
- **用途**：Markdown 解析和转换为 HTML
- **官方文档**：https://marked.js.org
- **说明**：用于解析 Markdown 文件内容，将其转换为 HTML。支持 GitHub Flavored Markdown (GFM) 语法，包括代码块、表格、链接等扩展功能

### 3. 交互功能库

#### preact
- **版本**：^10.21.0
- **许可证**：MIT
- **用途**：轻量级 React 替代方案，用于构建交互式 UI 组件
- **官方文档**：https://preactjs.com
- **说明**：相比 React，Preact 体积更小（约 3KB），性能更好，适合用于交互式组件。本项目中用于搜索模态框、评论系统等交互功能

#### pixi.js
- **版本**：^7.4.3
- **许可证**：MIT
- **用途**：高性能 2D WebGL 渲染引擎
- **官方文档**：https://pixijs.com
- **说明**：用于 Live2D 看板娘的渲染引擎，提供硬件加速的 2D 图形渲染能力

#### pixi-live2d-display
- **版本**：^0.4.0
- **许可证**：MIT
- **用途**：Pixi.js 的 Live2D 插件，用于加载和渲染 Live2D 模型
- **GitHub**：https://github.com/guansss/pixi-live2d-display
- **说明**：基于 Pixi.js 实现 Live2D Cubism 模型的加载、渲染和动画播放。支持 Cubism 3/4 格式的模型文件

### 4. 开发工具

#### typescript
- **版本**：^5.4.5
- **许可证**：Apache-2.0
- **用途**：JavaScript 的超集，添加静态类型系统
- **官方文档**：https://www.typescriptlang.org
- **说明**：提供类型检查、代码提示、重构支持等功能，提高代码质量和开发效率。项目的工具函数（posts.ts、markdown.ts 等）均使用 TypeScript 编写

---

## 开发依赖（devDependencies）

开发依赖仅在开发环境中使用，不会被打包到生产构建中。

### astro-compress
- **版本**：^2.3.8
- **许可证**：MIT
- **用途**：Astro 构建优化插件，自动压缩 HTML、CSS、JavaScript 和图片资源
- **GitHub**：https://github.com/astro-community/astro-compress
- **说明**：在构建时自动压缩静态资源，减小文件体积，提升网站加载速度。支持 HTML 压缩、CSS 压缩、JS 压缩和图片优化

---

## 依赖库分类统计

### 按功能分类

| 分类 | 依赖库 | 数量 |
|------|--------|------|
| 核心框架 | astro | 1 |
| Astro 集成 | @astrojs/preact, @astrojs/rss, @astrojs/sitemap, @astrojs/check | 4 |
| 内容处理 | marked | 1 |
| 交互框架 | preact | 1 |
| 图形渲染 | pixi.js, pixi-live2d-display | 2 |
| 开发工具 | typescript | 1 |
| 构建优化 | astro-compress | 1 |
| **总计** | | **11** |

### 按许可证分类

| 许可证 | 依赖库数量 | 占比 |
|--------|-----------|------|
| MIT | 10 | 90.9% |
| Apache-2.0 | 1 | 9.1% |
| **总计** | **11** | **100%** |

**说明**：所有依赖库均为开源软件，MIT 和 Apache-2.0 许可证均允许商业使用和修改，无法律风险。

---

## 依赖关系说明

### 核心依赖链

```
astro (核心框架)
├── @astrojs/preact (Preact 集成)
│   └── preact (交互组件库)
├── @astrojs/rss (RSS 生成)
├── @astrojs/sitemap (Sitemap 生成)
└── @astrojs/check (类型检查)
    └── typescript (类型系统)

marked (Markdown 解析)

pixi.js (渲染引擎)
└── pixi-live2d-display (Live2D 插件)
```

### 功能依赖关系

- **内容管理**：`marked` → 解析 Markdown 文件
- **组件系统**：`astro` + `@astrojs/preact` + `preact` → 构建交互式组件
- **Live2D 功能**：`pixi.js` + `pixi-live2d-display` → 渲染虚拟形象
- **SEO 优化**：`@astrojs/rss` + `@astrojs/sitemap` → 生成 RSS 和 Sitemap
- **开发体验**：`typescript` + `@astrojs/check` → 类型检查和代码提示
- **构建优化**：`astro-compress` → 资源压缩

---

## 版本选择说明

### 主要版本选择理由

1. **Astro 4.10.1**
   - 选择理由：4.x 版本稳定，功能完善，性能优化良好
   - 向后兼容：与 3.x 版本 API 基本兼容

2. **TypeScript 5.4.5**
   - 选择理由：5.x 版本类型系统更完善，性能更好
   - 新特性：支持最新的 TypeScript 特性，如装饰器、类型推断等

3. **Preact 10.21.0**
   - 选择理由：轻量级，性能优异，API 与 React 兼容
   - 替代方案：相比 React（约 40KB），Preact 仅约 3KB，更适合静态站点

4. **marked 17.0.0**
   - 选择理由：成熟的 Markdown 解析库，支持 GFM，性能稳定
   - 安全性：17.x 版本修复了之前版本的安全问题

5. **pixi.js 7.4.3**
   - 选择理由：7.x 版本性能优异，WebGL 2.0 支持良好
   - 兼容性：支持现代浏览器，向后兼容 WebGL 1.0

---

## 安装与更新

### 安装依赖

```bash
# 安装所有依赖（包括开发依赖）
npm install

# 仅安装生产依赖
npm install --production
```

### 更新依赖

```bash
# 检查过时的依赖
npm outdated

# 更新所有依赖到最新版本（谨慎使用）
npm update

# 更新特定依赖
npm update astro
```

### 添加新依赖

```bash
# 添加生产依赖
npm install <package-name>

# 添加开发依赖
npm install -D <package-name>
```

---

## 依赖管理最佳实践

### 1. 版本锁定

项目使用 `package.json` 中的 `^` 版本前缀，允许自动安装补丁版本和次版本更新，但不更新主版本，确保兼容性。

### 2. 安全性检查

定期运行以下命令检查依赖安全性：

```bash
# 检查安全漏洞
npm audit

# 自动修复安全漏洞
npm audit fix
```

### 3. 依赖分析

使用以下工具分析依赖：

```bash
# 查看依赖树
npm ls

# 查看依赖大小
npx bundle-phobia <package-name>
```

### 4. 版本控制

- `package.json` 已提交到版本控制
- `package-lock.json` 已提交到版本控制，确保团队使用相同的依赖版本
- 不要提交 `node_modules/` 目录

---

## 许可证兼容性

所有依赖库的许可证均兼容项目使用：

- **MIT 许可证**：允许商业使用、修改、分发，只需保留版权声明
- **Apache-2.0 许可证**：类似 MIT，但包含专利授权条款

**结论**：所有依赖库均可安全使用，无许可证冲突风险。

---

## 性能影响分析

### 生产构建大小（估算）

| 依赖库 | 预估大小 | 说明 |
|--------|---------|------|
| astro | ~0 KB（构建时） | 仅构建时使用，不打包到客户端 |
| preact | ~3 KB (gzipped) | 仅交互组件需要时才加载 |
| pixi.js | ~200 KB (gzipped) | Live2D 功能按需加载 |
| pixi-live2d-display | ~50 KB (gzipped) | Live2D 功能按需加载 |
| marked | ~0 KB（构建时） | 仅构建时使用 |
| **客户端 JS 总量** | **~253 KB** | 大部分按需加载 |

**说明**：
- Astro 框架和构建工具不会打包到客户端
- marked 仅在构建时使用，不增加运行时负担
- Preact 和 Pixi.js 等交互库按需加载，不影响首屏性能
- 通过代码分割和懒加载，实际加载的 JavaScript 远小于总大小

---

## 替代方案说明

### 已考虑的替代方案

1. **React vs Preact**
   - 选择 Preact：体积更小，性能更好，适合静态站点
   - React 优势：生态更丰富，但体积较大

2. **marked vs remark**
   - 选择 marked：API 简单，成熟稳定
   - remark 优势：更灵活，插件生态丰富，但配置复杂

3. **pixi.js vs three.js**
   - 选择 pixi.js：2D 渲染性能更好，体积更小
   - three.js 优势：3D 功能强大，但体积较大，不适合 2D 场景

---

## 维护建议

### 定期维护任务

1. **每月检查**：运行 `npm outdated` 查看可用更新
2. **每季度更新**：更新次要版本和补丁版本
3. **安全更新**：及时应用安全补丁（`npm audit fix`）
4. **主版本更新**：谨慎评估，充分测试后再更新

### 升级策略

- **补丁版本**（如 4.10.1 → 4.10.2）：直接更新，通常只有 bug 修复
- **次版本**（如 4.10.1 → 4.11.0）：测试后更新，可能有新功能
- **主版本**（如 4.x → 5.x）：仔细阅读迁移指南，充分测试，可能有破坏性变更

---

## 附录：完整 package.json 参考

```json
{
  "name": "nextblog",
  "type": "module",
  "version": "0.0.1",
  "scripts": {
    "dev": "astro dev",
    "start": "astro dev",
    "build": "NODE_OPTIONS=--max-old-space-size=4096 astro check && NODE_OPTIONS=--max-old-space-size=4096 astro build",
    "preview": "astro preview",
    "astro": "astro"
  },
  "dependencies": {
    "@astrojs/check": "^0.5.10",
    "@astrojs/preact": "^3.4.0",
    "@astrojs/rss": "^4.0.5",
    "@astrojs/sitemap": "^3.2.0",
    "astro": "^4.10.1",
    "marked": "^17.0.0",
    "pixi-live2d-display": "^0.4.0",
    "pixi.js": "^7.4.3",
    "preact": "^10.21.0",
    "typescript": "^5.4.5"
  },
  "devDependencies": {
    "astro-compress": "^2.3.8"
  }
}
```

---

**文档版本**：v1.0  
**最后更新**：2024年  
**维护者**：项目开发团队

